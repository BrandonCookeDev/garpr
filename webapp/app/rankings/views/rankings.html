<div class="container">
    <br/>
    <div class="panel panel-default" id="rankingsControlPanel" ng-show="sessionService.isAdminForRegion(regionService.region.id)">
        <div class="panel-heading">
            <h4 class="panel-title">
                <a ng-click="isRankingsCollapsed = !isRankingsCollapsed">
                    <label>Rankings Control Panel <span class="caret"></span></label>
                </a>
            </h4>
        </div>
        <div collapse="!isRankingsCollapsed">
            <div class="panel-body">
                <form id="rankingsControlPanelForm" ng-submit="saveRegionRankingsCriteria()">
                <!-- Options to tweak rankings go here -->
                <h3>Ranking Qualification:</h3>
                <span>
                    <input type="number" maxlength='3' class="mobile"
                           id="numberDaysBackText" ng-model="rankingNumDaysBack"/> <label>Days Back.</label>
                </span>
                <br/><br/>
                <span>
                    <span><label>Has Attended At Least</label></span>
                    <span><input type="number" maxlength="3" class='mobile'
                                 ng-model="rankingsNumTourneysAttended"/></span>
                    <span><label>Tournaments</label></span>

                </span>
                
                    </br>
                    <hr/>
                    <br/>
                <span>
                    <h3>Tournament Inclusion:</h3>
                    <span><label>Include Tournaments</label></span>
                    <span><input type="number" maxlength="3" class="mobile"
                                 ng-model="tourneyNumDaysBack"/></span>
                    <span><label>Days Back</label></span>
                <!--
                    <br/>
                    OR
                    <br/>
                    Include Tournaments From <input type="date" ng-model="tournamentsBackStartDate" hint="mm/dd/yyyy"/>
                -->
                </span>
                    <br/><br/>
                    <input type="submit" value="Save Changes" class="mobile"/>
                </form>
            </div>
        </div>
    </div>

    <!-- TIER LIST CONTROL PANEL DROPDOWN -->
    <div class="panel panel-default" id="tierlistControlPanel" ng-show="sessionService.isAdminForRegion(regionService.region.id)">
        <div class="panel-heading">
            <h4 class="panel-title">
                <a ng-click="isTiersCollapsed = !isTiersCollapsed">
                    <label>Tier List Control Panel <span class="caret"></span></label>
                </a>
            </h4>
        </div>
        <div collapse="!isTiersCollapsed">
            <div class="panel-body">
                <label class="mobile" ng-show="tiers.length > 0">There are no tiers for this region yet!</label>
                <div ng-repeat="tier in tiers">
                    < ng-hide="tiers[tier].isEdit">
                        <label class="mobile">Name: {{tier.name}}</label><br/>
                        <label class="mobile">Color: {{tier.color}}</label><br/>
                        <label class="mobile">Upper Rank: {{tier.upper_rank}}</label><br/>
                        <label class="mobile">Lower Rank: {{tier.lower_rank}}</label><br/>
                        <label class="mobile">Upper Skill: {{tier.upper_skill}}</label><br/>
                        <label class="mobile">Lower Skill: {{tier.lower_skill}}</label><br/>
                        <input type="button" class="btn mobile" ng-click="tiers[tier].isEdit=true" value="Edit" />
                    </div>
                    <div ng-show="tiers[tier].isEdit">
                        <form ng-submit="updateRankingTier(tiers[tier])">
                            <label class="mobile">Current Name: </label>
                            <input type="text" class="mobile" ng-model="tiers[tier].name" value="tier.name" />
                            <br/>
                            <label class="mobile">New Name</label>
                            <input type="text" class="mobile" ng-model="tiers[tier].new_name" value="" />
                            <br/>
                            <label class="mobile">Color: </label>
                            <input type="color" class="mobile" ng-model="tiers[tier].new_color" value="tier.color" />
                            <br/>
                            <label class="mobile">Upper Rank: </label>
                            <input type="number" class="mobile" ng-model="tiers[tier].new_upper_rank" value="tier.upper_rank" />
                            <br/>
                            <label class="mobile">Lower Rank: </label>
                            <input type="number" class="mobile" ng-model="tiers[tier].new_lower_rank" value="tier.lower_rank" />
                            <br/>
                            <label class="mobile">Upper Skill: </label>
                            <input type="number" step="any" class="mobile" ng-model="tiers[tier].new_upper_skill" value="tier.upper_skill" />
                            <br/>
                            <label class="mobile">Lower Skill: </label>
                            <input type="number" step="any" class="mobile" ng-model="tiers[tier].new_lower_skill" value="tier.lower_skill" />
                            <br/>
                            <input type="submit" class="btn mobile" value="Submit" />
                        </form>
                    </div>

                </div>
                <div ng-repeat="newTier in newTierForms">
                    <form ng-submit="insertNewRankingTier(newTiers[newTier])">
                        <label class="mobile">Name: </label>
                        <input type="text" class="mobile" ng-model="newTiers[newTier].name" />
                        <br/>
                        <label class="mobile">Color: </label>
                        <input type="color" class="mobile" ng-model="newTiers[newTier].color" />
                        <br/>
                        <label class="mobile">Upper Rank: </label>
                        <input type="number" class="mobile" ng-model="newTiers[newTier].upper_rank" />
                        <br/>
                        <label class="mobile">Lower Rank: </label>
                        <input type="number" class="mobile" ng-model="newTiers[newTier].lower_rank" />
                        <br/>
                        <label class="mobile">Upper Skill: </label>
                        <input type="number" step="any" class="mobile" ng-model="newTiers[newTier].upper_skill" />
                        <br/>
                        <label class="mobile">Lower Skill: </label>
                        <input type="number" step="any" class="mobile" ng-model="newTiers[newTier].lower_skill" />
                        <br/>
                        <input type="submit" class="btn mobile" value="Submit" />
                    </form>
                </div>

                <!-- ADD BUTTON -->
                <button type="btn mobile" ng-click="addNewTierForm()">Add Tier</button>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-8">
            <h3>Rankings as of {{rankingsService.rankingsList.time.substring(0,10)}}</h3>
        </div>
        <div class="col-md-2">
            <button type="button" class="btn mobile" ng-hide="tierlistView" ng-click="applyTiersToRankings()">Tier List View</button>
            <button type="button" class="btn mobile" ng-show="tierlistView" ng-click="applyTiersToRankings()">Ladder View</button>
        </div>
        <div class="col-md-2" ng-show="sessionService.isAdmin()">
            <h3 class="text-right">
                <button type="button" class="btn btn-danger mobile" ng-click="prompt()">Regenerate rankings</button>
            </h3>
        </div>
    </div>
    <div class="row">
        <div ng-show="!sessionService.isAdmin() && rankingsNumTourneysAttended && rankingNumDaysBack" class="col-md-10">
            <h4> Region Qualification: Competed in {{ rankingsNumTourneysAttended }} Tournaments within {{ rankingNumDaysBack }} Days </h4>
            <h4> Tournaments From the Past {{ tourneyNumDaysBack }} Days Used in Calculation. </h4>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <table class="table table-striped table-condensed">
                <tr class="table_header">
                    <th>Rank</th>
                    <th>Name</th>
                    <th>Rating</th>
                </tr>
                <tr ng-repeat="line in rankingsService.rankingsList.ranking" class="table_line">
                    <td><b>{{line.rank}}</b></td>
                    <td><a href="#/{{regionService.region.id}}/players/{{line.id}}">{{line.name}}</a></td>
                    <td>{{line.rating | number:3}}</td>
                </tr>
            </table>
        </div>
    </div>
</div>
